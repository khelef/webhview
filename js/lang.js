const translations = {
  fr: {
    "title": "HolisticView",
    "header.logo": "HolisticView",
    "nav.home": "Accueil",
    "nav.about": "Société",
    "nav.solutions": "Solutions ▾",
    "nav.clients": "Clients",
    "nav.news": "Actualités",
    "nav.contact": "Contact",

    "btn.demo": "Demander une démo",
    "form.title": "Demande de démonstration",
    "form.subtitle": "Demande de démonstration",
    "form.name": "Nom complet :",
    "form.email": "Email :",
    "form.company": "Entreprise :",
    "form.function": "Fonction :",
    "form.selectFunction": "-- Sélectionnez votre fonction --",
    "form.func.direction": "Direction générale",
    "form.func.marketing": "Marketing / Communication",
    "form.func.commercial": "Commercial / Vente",
    "form.func.it": "Informatique / IT",
    "form.func.production": "Production / Exploitation",
    "form.func.qse": "Qualité / Sécurité / Environnement (QSE)",
    "form.func.logistique": "Logistique / Supply Chain",
    "form.func.achats": "Achats / Approvisionnement",
    "form.func.rh": "Ressources humaines",
    "form.func.finance": "Finance / Comptabilité",
    "form.func.support": "Support / Service client",
    "form.func.autre": "Autre",
    "form.sector": "Secteur :",
    "form.selectSector": "-- Sélectionnez votre secteur --",
    "form.sector.industrie": "Industrie",
    "form.sector.banque": "Banque / Assurance",
    "form.sector.tech": "Technologie / Informatique",
    "form.sector.sante": "Santé / Pharmaceutique",
    "form.sector.agro": "Agroalimentaire",
    "form.sector.commerce": "Commerce / Distribution",
    "form.sector.services": "Services",
    "form.sector.public": "Secteur public",
    "form.sector.transport": "Transport / Logistique",
    "form.sector.energie": "Énergie / Environnement",
    "form.sector.autre": "Autre",
    "form.message": "Message :",
    "form.submit": "Envoyer",
    "form.success": "✅ Merci pour votre contact !\nNous vous répondrons dans les plus brefs délais.",

    "solutions.dataConnexion": "Connexion et Contextualisation des Données",
    "solutions.dataContext": "Surveillance de Processus de bout en bout",
    "solutions.rootCause": "Analyse automatisée des Causes Racines",
    "solutions.dataConnexionText": "Découvrez notre solution de data connexion pour intégrer vos machines et vos systèmes MES afin de collecter et centraliser vos données en temps réel.",
    "solutions.dataContextText": "Notre solution permet de contextualiser vos données industrielles pour faciliter l’analyse et la prise de décision.",
    "solutions.rootCauseText": "Cette solution vous aide à identifier les causes principales des incidents pour améliorer vos processus et réduire les pertes.",


    "contact.titl": "Contactez-nous",
    "contact.text2": "Vous avez une question ou vous souhaitez nous faire part de votre projet de MES ? L’équipe vous répondra au plus vite",


    "contact.title": "Contactez-nous et boostez votre productivité !",
    "contact.text1": "Prêt à franchir le cap de la digitalisation industrielle ? <strong>Contactez notre équipe</strong> et découvrez comment <strong>Holistic View MES</strong> peut améliorer votre <strong>TRS</strong>, votre consommation énergétique et votre suivi qualité.",
    "contact.text2": "Parlez-nous de votre projet et obtenez une démonstration personnalisée !",
    "contact.label.nom": "Nom :",
    "contact.label.prenom": "Prénom :",
    "contact.label.societe": "Société :",
    "contact.label.email": "E-mail :",
    "contact.label.source": "Comment avez-vous entendu parler de nous ?",
    "form.source1": "Réseaux sociaux",
    "form.source2": "Recommandation",
    "form.source3": "Salon professionnel",
    "form.source4": "Moteur de recherche ",
    "form.source5": "Autre",
    "contact.label.objet": "Objet :",
    "contact.label.message": "Votre message :",
    "contact.btn.envoyer": "Envoyer",

    "footer.company": "HOLISTIC VIEW",
    "footer.address": "1, rue Henri Spriet, 14120 Mondeville",
    "footer.phone": "09 71 12 01 73",
    "footer.email": "contact[@]holisticview.com",
    "footer.newsTitle": "Dernières actus",
    "footer.news1": "Salon SEPEM Angers 2025",
    "footer.news2": "Salon Prod&Pack Lyon 2025",
    "footer.news3": "Article thématique : Le Management visuel",
    "footer.news4": "Partenariat Sofrastock",
    "footer.info": "Informations utiles",
    "footer.about": "Société Holistic View",
    "footer.contact": "Contactez-nous",
    "footer.demo": "Demander une démonstration",
    "footer.legal": "Mentions légales",
    "footer.sitemap": "Plan du site",
    "social.text": "Retrouvez-nous sur <strong>LinkedIn</strong>",


  },
  en: {

   
    "title": "HolisticView",
    "header.logo": "HolisticView",
    "nav.home": "Home",
    "nav.about": "Company",
    "nav.solutions": "Solutions ▾",
    "nav.clients": "Clients",
    "nav.news": "News",
    "nav.contact": "Contact",

    "btn.demo": "Ask a Demo",
    "form.title": "Ask for a demo",
    "form.subtitle": "Ask for a demo",
    "form.name": "Full Name:",
    "form.email": "Email:",
    "form.company": "Company:",
    "form.function": "Function:",
    "form.selectFunction": "-- Select your function --",
    "form.func.direction": "General Management",
    "form.func.marketing": "Marketing / Communication",
    "form.func.commercial": "Sales",
    "form.func.it": "IT",
    "form.func.production": "Production / Operations",
    "form.func.qse": "Quality / Safety / Environment (QSE)",
    "form.func.logistique": "Logistics / Supply Chain",
    "form.func.achats": "Purchasing",
    "form.func.rh": "Human Resources",
    "form.func.finance": "Finance / Accounting",
    "form.func.support": "Support / Customer Service",
    "form.func.autre": "Other",
    "form.sector": "Sector:",
    "form.selectSector": "-- Select your sector --",
    "form.sector.industrie": "Industry",
    "form.sector.banque": "Banking / Insurance",
    "form.sector.tech": "Technology / IT",
    "form.sector.sante": "Health / Pharmaceutical",
    "form.sector.agro": "Agro-food",
    "form.sector.commerce": "Commerce / Distribution",
    "form.sector.services": "Services",
    "form.sector.public": "Public Sector",
    "form.sector.transport": "Transport / Logistics",
    "form.sector.energie": "Energy / Environment",
    "form.sector.autre": "Other",
    "form.message": "Message:",
    "form.submit": "Send",
    "form.success": "✅ Thank you for contacting us!\nWe will reply as soon as possible.",

    "solutions.dataConnexion": "Data Connection and Contextualisation",
    "solutions.dataContext": "End-to-end Process Monitoring",
    "solutions.rootCause": " Automated Root Cause Analysis",
    "solutions.dataConnexionText": "Discover our data connection solution to integrate your machines and MES systems, collecting and centralizing your data in real time.",
    "solutions.dataContextText": "Our solution contextualizes your industrial data to facilitate analysis and decision-making.",
    "solutions.rootCauseText": "This solution helps identify the root causes of incidents to improve processes and reduce losses.",

    "contact.titl": "Contact Us",
    "contact.text2": "Do you have a question or would you like to tell us about your MES project? Our team will get back to you as soon as possible.",



    "contact.title": "Contact us and boost your productivity!",
    "contact.text1": "Ready to take the leap into industrial digitalization? <strong>Contact our team</strong> and discover how <strong>Holistic View MES</strong> can improve your <strong>OEE</strong>, energy consumption, and quality tracking.",
    "contact.text2": "Tell us about your project and get a personalized demo!",
    "contact.label.nom": "Last name:",
    "contact.label.prenom": "First name:",
    "contact.label.societe": "Company:",
    "contact.label.email": "Email:",
    "contact.label.source": "How did you hear about us?",
    "form.source1": "Social media",
    "form.source2": "Recommendation",
    "form.source3": "Trade fair",
    "form.source4": "search engine",
    "form.source5": "Other",
    "contact.label.objet": "Subject:",
    "contact.label.message": "Your message:",
    "contact.btn.envoyer": "Send",

    "footer.company": "HOLISTIC VIEW",
    "footer.address": "1, rue Henri Spriet, 14120 Mondeville, France",
    "footer.phone": "+33 9 71 12 01 73",
    "footer.email": "contact[@]holisticview.com",
    "footer.newsTitle": "Latest news",
    "footer.news1": "SEPEM Angers 2025",
    "footer.news2": "Prod&Pack Lyon 2025",
    "footer.news3": "Thematic article: Visual Management",
    "footer.news4": "Sofrastock Partnership",
    "footer.info": "Useful information",
    "footer.about": "About Holistic View",
    "footer.contact": "Contact us",
    "footer.demo": "Request a demo",
    "footer.legal": "Legal notice",
    "footer.sitemap": "Site map",
    "social.text": "Follow us on <strong>LinkedIn</strong>"
  }
};

function setLanguage(lang) {
  localStorage.setItem("lang", lang);
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (translations[lang][key]) el.innerHTML = translations[lang][key];
  });
}


// =============================================
// FONCTIONS DE TRADUCTION
// =============================================

function applyTranslations(lang) {
  console.log('Applying translations for:', lang);
  
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    
    if (translations[lang] && translations[lang][key]) {
      // Pour les inputs avec placeholder
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
        el.placeholder = translations[lang][key];
      } 
      // Pour les images avec alt
      else if (el.tagName === 'IMG') {
        el.alt = translations[lang][key];
      }
      // Pour les autres éléments
      else {
        el.innerHTML = translations[lang][key];
      }
    }
  });
}

function setLanguage(lang) {
  // Sauvegarder la langue
  localStorage.setItem('holistic_lang', lang);
  
  // Appliquer les traductions
  applyTranslations(lang);
  
  // Mettre à jour l'URL pour conserver la langue
  if (window.location.search.indexOf('lang=') === -1) {
    const newUrl = window.location.pathname + '?lang=' + lang + window.location.hash;
    history.replaceState(null, '', newUrl);
  }
}

// =============================================
// GESTION DU MENU MOBILE (votre code existant)
// =============================================

document.addEventListener('DOMContentLoaded', function() {
  console.log('Site Holistic View chargé');
  
  // =============================================
  // CHARGER LA LANGUE AU DÉMARRAGE
  // =============================================
  
  // Vérifier l'URL d'abord
  const urlParams = new URLSearchParams(window.location.search);
  const urlLang = urlParams.get('lang');
  
  // Sinon vérifier localStorage
  const savedLang = localStorage.getItem('holistic_lang');
  
  // Langue par défaut
  const lang = urlLang || savedLang || 'fr';
  
  // Appliquer la langue
  applyTranslations(lang);
  
  // Configurer les boutons de langue
  document.querySelectorAll('.lang-btn').forEach(btn => {
    // Remplacer onclick par addEventListener
    const oldOnClick = btn.getAttribute('onclick');
    if (oldOnClick) {
      btn.removeAttribute('onclick');
      
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Détecter la langue cible
        let targetLang = 'fr';
        if (oldOnClick.includes("'en'")) {
          targetLang = 'en';
        }
        
        // Changer de langue
        setLanguage(targetLang);
        
        // Ajouter le paramètre lang à l'URL
        const currentUrl = new URL(window.location);
        currentUrl.searchParams.set('lang', targetLang);
        window.history.replaceState({}, '', currentUrl);
      });
    }
  });
  
  // =============================================
  // MODIFIER LA NAVIGATION POUR CONSERVER LA LANGUE
  // =============================================
  
  const sitePages = [
    'index.html',
    'societe.html', 
    'data_connexion.html',
    'data_contextualisation.html',
    'analyse_des_causes_racine.html',
    'actualites.html',
    'contact.html',
    'legal.html',
    'demo.html'
  ];
  
  document.querySelectorAll('a[href]').forEach(link => {
    const href = link.getAttribute('href');
    
    // Vérifie si c'est un lien interne
    const isInternalPage = sitePages.some(page => href && href.includes(page));
    
    if (isInternalPage && href !== '#form-demo') {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Récupérer la langue actuelle
        const currentLang = localStorage.getItem('holistic_lang') || 'fr';
        
        // Ferme la modal si ouverte
        const modal = document.getElementById('form-demo');
        if (modal && modal.style.display === 'flex') {
          modal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
        
        // Ferme le menu mobile si ouvert
        if (window.innerWidth <= 768) {
          const navItems = document.querySelector('.nav-items');
          if (navItems && navItems.classList.contains('active')) {
            navItems.classList.remove('active');
            navItems.style.display = 'none';
            const menuToggle = document.querySelector('.menu-toggle');
            if (menuToggle) {
              menuToggle.innerHTML = '☰';
              menuToggle.setAttribute('aria-label', 'Ouvrir le menu');
            }
          }
        }
        
        // Construire l'URL avec le paramètre de langue
        let newUrl = href;
        const separator = newUrl.includes('?') ? '&' : '?';
        newUrl += `${separator}lang=${currentLang}`;
        
        // Naviguer vers la page
        setTimeout(() => {
          window.location.href = newUrl;
        }, 100);
      });
    }
  });
  
  // =============================================
  // VOTRE CODE EXISTANT POUR MENU MOBILE
  // =============================================
  
  // Crée le bouton hamburger
  const menuToggle = document.createElement('button');
  menuToggle.className = 'menu-toggle';
  menuToggle.innerHTML = '☰';
  menuToggle.setAttribute('aria-label', 'Menu principal');
  menuToggle.style.display = 'none';
  
  // Ajoute le bouton au header
  const header = document.querySelector('.header');
  if (header) {
    header.appendChild(menuToggle);
    
    // Gère l'affichage du menu sur mobile
    function updateMenuForMobile() {
      const navItems = document.querySelector('.nav-items');
      if (window.innerWidth <= 768) {
        menuToggle.style.display = 'block';
        if (!navItems.classList.contains('active')) {
          navItems.style.display = 'none';
        }
      } else {
        menuToggle.style.display = 'none';
        navItems.style.display = 'flex';
        navItems.classList.remove('active');
      }
    }
    
    // Initialise
    updateMenuForMobile();
    
    // Met à jour au redimensionnement
    window.addEventListener('resize', updateMenuForMobile);
    
    // Gère le clic sur le bouton hamburger
    menuToggle.addEventListener('click', function() {
      const navItems = document.querySelector('.nav-items');
      navItems.classList.toggle('active');
      if (navItems.classList.contains('active')) {
        navItems.style.display = 'flex';
        menuToggle.innerHTML = '✕';
        menuToggle.setAttribute('aria-label', 'Fermer le menu');
      } else {
        navItems.style.display = 'none';
        menuToggle.innerHTML = '☰';
        menuToggle.setAttribute('aria-label', 'Ouvrir le menu');
      }
    });
    
    // Ferme le menu en cliquant sur un lien (mobile)
    document.querySelectorAll('.nav-items a').forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 768) {
          const navItems = document.querySelector('.nav-items');
          navItems.classList.remove('active');
          navItems.style.display = 'none';
          menuToggle.innerHTML = '☰';
          menuToggle.setAttribute('aria-label', 'Ouvrir le menu');
        }
      });
    });
  }
  
  // =============================================
  // CAPTCHA DYNAMIQUE (votre code existant)
  // =============================================
  
  function generateCaptcha() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let captcha = '';
    for (let i = 0; i < 5; i++) {
      captcha += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return captcha;
  }
  
  const captchaText = document.getElementById('captcha-text');
  const refreshCaptcha = document.getElementById('refresh-captcha');
  
  if (captchaText && refreshCaptcha) {
    captchaText.textContent = generateCaptcha();
    
    refreshCaptcha.addEventListener('click', function() {
      captchaText.textContent = generateCaptcha();
    });
  }
  
  // =============================================
  // GESTION DE LA MODAL (votre code existant)
  // =============================================
  
  // Fermer la modal avec Échap
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const modal = document.getElementById('form-demo');
      if (modal && modal.style.display === 'flex') {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    }
  });
  
  // Fermer en cliquant en dehors
  const modal = document.getElementById('form-demo');
  if (modal) {
    modal.addEventListener('click', function(e) {
      if (e.target === this) {
        this.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    });
  }
  
  // =============================================
  // FORMULAIRE DE CONTACT (votre code existant)
  // =============================================
  
  const contactForm = document.querySelector('.contact-form');
  if (contactForm) {
    contactForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Validation simple du captcha
      const captchaInput = this.querySelector('input[placeholder*="captcha"]');
      const captchaDisplay = document.getElementById('captcha-text');
      
      if (captchaInput && captchaDisplay) {
        if (captchaInput.value.toUpperCase() !== captchaDisplay.textContent) {
          alert('Code captcha incorrect. Veuillez réessayer.');
          captchaInput.value = '';
          captchaInput.focus();
          return false;
        }
      }
      
      // Simulation d'envoi (remplacer par votre code réel)
      alert('Formulaire soumis avec succès ! (simulation)');
      this.reset();
      if (captchaDisplay) {
        captchaDisplay.textContent = generateCaptcha();
      }
      
      return false;
    });
  }
  
  // =============================================
  // AMÉLIORATIONS UX (votre code existant)
  // =============================================
  
  // Smooth scroll pour les ancres
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      if (this.getAttribute('href') !== '#form-demo') {
        const targetId = this.getAttribute('href');
        if (targetId.length > 1) {
          e.preventDefault();
          const targetElement = document.querySelector(targetId);
          if (targetElement) {
            window.scrollTo({
              top: targetElement.offsetTop - 80,
              behavior: 'smooth'
            });
          }
        }
      }
    });
  });
  
  // Animation au scroll
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
      }
    });
  }, observerOptions);
  
  // Observe les éléments à animer
  document.querySelectorAll('.contact-section, .contact-intro').forEach(el => {
    observer.observe(el);
  });
});

// =============================================
// FONCTIONS GLOBALES (votre code existant)
// =============================================

// Fonction pour ouvrir la modal (optionnel)
function openModal() {
  const modal = document.getElementById('form-demo');
  if (modal) {
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    window.location.hash = '#form-demo';
  }
}

// Fonction pour fermer la modal (optionnel)
function closeModal() {
  const modal = document.getElementById('form-demo');
  if (modal) {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
    if (window.location.hash === '#form-demo') {
      history.replaceState(null, null, ' ');
    }
  }
}

// Initialisation au chargement
window.addEventListener('load', function() {
  console.log('Page complètement chargée');
  
  // Réappliquer les traductions au cas où
  const savedLang = localStorage.getItem('holistic_lang') || 'fr';
  applyTranslations(savedLang);
});